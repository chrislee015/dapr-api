spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8180/realms/Spring_Sandbox


server:
  port: 8080

#spring:
#  application:
#    name: gateway
#  cloud:
#    gateway:
#      routes:
#        - id: api-service
#          uri: http://gateway-dapr:3501
#          predicates:
#            - Path=/api/**
#          filters:
#            - RewritePath=/api/(?<segment>.*), /v1.0/invoke/api-service/method/${segment}
#        - id: database-service
#          uri: http://gateway-dapr:3501
#          predicates:
#            - Path=/db/**
#          filters:
#            - RewritePath=/db/(?<segment>.*), /v1.0/invoke/database-service/method/${segment}
#        - id: batch-service
#          uri: http://gateway-dapr:3501
#          predicates:
#            - Path=/batch/**
#          filters:
#            - RewritePath=/batch/(?<segment>.*), /v1.0/invoke/batch-service/method/${segment}
#        - id: messaging-service
#          uri: http://gateway-dapr:3501
#          predicates:
#            - Path=/msg/**
#          filters:
#            - RewritePath=/msg/(?<segment>.*), /v1.0/invoke/messaging-service/method/${segment}
#
#management:
#  endpoints:
#    web:
#      exposure:
#        include: health,info,prometheus
#
#---
#
#server:
#  port: 8080
#  ssl:
#    enabled: true
#    key-store: classpath:certificates/keystore.p12
#    key-store-password: changeit
#    key-store-type: PKCS12
#    key-alias: gateway
#  # Force HTTPS redirect
#  error:
#    include-stacktrace: always
#    include-message: always
#    include-binding-errors: always
#
#spring:
#  application:
#    name: api-gateway
#  profiles:
#    active: default
#  cloud:
#    gateway:
#      # Global HTTPS redirect
#      routes:
#        # API Route - Direct to backend API
#        - id: api-route
#          uri: ${gateway.routing.api.uri:http://localhost:8081}
#          predicates:
#            - Path=/api/**
#            - Header=X-Forwarded-Proto, https
#          filters:
#            - name: AuthenticationFilter
#            - StripPrefix=1
#            - AddRequestHeader=X-User-Claims, ${userClaims:}
#            - AddRequestHeader=X-User-Roles, ${userRoles:}
#
#        # DAPR Route - Via DAPR sidecar
#        - id: dapr-route
#          uri: ${gateway.routing.dapr.uri:http://localhost:3500}
#          predicates:
#            - Path=/dapr/**
#            - Header=X-Forwarded-Proto, https
#          filters:
#            - name: AuthenticationFilter
#            - StripPrefix=1
#            - AddRequestHeader=dapr-app-id, ${gateway.routing.dapr.app-id:api-service}
#            - AddRequestHeader=X-User-Claims, ${userClaims:}
#            - AddRequestHeader=X-User-Roles, ${userRoles:}
#
#        # Keycloak Authentication Route
#        - id: auth-route
#          uri: ${keycloak.server-url:http://localhost:8180}
#          predicates:
#            - Path=/auth/**
#          filters:
#            - StripPrefix=1
#
#      # Global filters
#      default-filters:
#        - name: GlobalErrorHandlingFilter
#        - name: LoggingFilter
#        - name: HttpsRedirectFilter
#        - name: ValidationFilter
#      server:
#        webflux:
#          globalcors:
#            cors-configurations:
#              '[/**]':
#                          allowed-origins: "https://localhost:*"
#                          allowed-methods: "*"
#                          allowed-headers: "*"
#                          allow-credentials: true
#
#  security:
#    oauth2:
#      resourceserver:
#        jwt:
#          issuer-uri: ${keycloak.server-url:http://localhost:8180}/realms/${keycloak.realm:master}
#          jwk-set-uri: ${keycloak.server-url:http://localhost:8180}/realms/${keycloak.realm:master}/protocol/openid-connect/certs
#      client:
#        registration:
#          keycloak:
#            client-id: ${keycloak.client-id:gateway-client}
#            client-secret: ${keycloak.client-secret:your-client-secret}
#            scope: openid,profile,roles
#            authorization-grant-type: authorization_code
#            redirect-uri: https://localhost:8080/login/oauth2/code/keycloak
#        provider:
#          keycloak:
#            issuer-uri: ${keycloak.server-url}:http://localhost:8180}/realms/${keycloak.realm:master}
#            authorization-uri: ${keycloak.server-url:http://localhost:8180}/realms/${keycloak.realm:master}/protocol/openid-connect/auth
#            token-uri: ${keycloak.server-url:http://localhost:8180}/realms/${keycloak.realm:master}/protocol/openid-connect/token
#            user-info-uri: ${keycloak.server-url:http://localhost:8180}/realms/${keycloak.realm:master}/protocol/openid-connect/userinfo
#            user-name-attribute: preferred_username
#
## Custom gateway configuration
#gateway:
#  routing:
#    mode: ${ROUTING_MODE:api} # api or dapr
#    api:
#      uri: ${API_SERVICE_URL:http://localhost:8081}
#    dapr:
#      uri: ${DAPR_HTTP_ENDPOINT:http://localhost:3500}
#      app-id: ${DAPR_APP_ID:api-service}
#
#  error-page:
#    enabled: true
#    path: /error
#    redirect-url: https://localhost:8080/error
#
## Keycloak configuration
#keycloak:
#  server-url: ${KEYCLOAK_SERVER_URL:http://localhost:8180}
#  realm: ${KEYCLOAK_REALM:master}
#  client-id: ${KEYCLOAK_CLIENT_ID:gateway-client}
#  client-secret: ${KEYCLOAK_CLIENT_SECRET:your-client-secret}
#
## Logging configuration
#logging:
#  level:
#    com.example.gateway: DEBUG
#    org.springframework.cloud.gateway: DEBUG
#    org.springframework.security: DEBUG
#  pattern:
#    console: '%d{yyyy-MM-dd HH:mm:ss} - %msg%n'
#    file: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'
#  file:
#    name: logs/gateway.log
#
## Management endpoints
#management:
#  endpoints:
#    web:
#      exposure:
#        include: health,info,metrics,gateway
#  endpoint:
#    health:
#      show-details: always